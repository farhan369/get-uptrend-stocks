<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSE Stock Screener - Advanced Technical Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(4, 120, 87, 0.4); }
            50% { box-shadow: 0 0 25px rgba(4, 120, 87, 0.7); }
        }
        .exceptional-glow { animation: pulse-glow 2s infinite; }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app">
        <div class="min-h-screen">
            <!-- Header -->
            <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-lg">
                <div class="container mx-auto px-4 py-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-3xl font-bold">üìà NSE Stock Screener</h1>
                            <p class="text-blue-100 mt-1">Advanced 120-Point Technical Analysis System</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-blue-100">API Status</div>
                            <div class="flex items-center gap-2 mt-1">
                                <div :class="apiStatus === 'connected' ? 'bg-green-400' : 'bg-red-400'" 
                                     class="w-3 h-3 rounded-full"></div>
                                <span class="font-semibold">{{ apiStatus === 'connected' ? 'Connected' : 'Disconnected' }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <div class="container mx-auto px-4 py-8">
                <!-- Preset Strategies -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ‚ö° Quick Screening Strategies
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <button v-for="(preset, key) in presets" :key="key"
                                @click="applyPreset(preset)"
                                class="p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left">
                            <div class="font-semibold text-lg mb-1">{{ preset.name }}</div>
                            <div class="text-sm text-gray-600">{{ preset.description }}</div>
                        </button>
                    </div>
                </div>

                <!-- Filters Panel -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        üîç Advanced Filters
                        <button @click="showFilters = !showFilters" class="ml-auto text-sm text-blue-600">
                            {{ showFilters ? '‚ñº Hide' : '‚ñ∂ Show' }}
                        </button>
                    </h2>
                    
                    <transition name="fade">
                        <div v-show="showFilters" class="space-y-6">
                            <!-- Score Filter -->
                            <div class="border-b pb-4">
                                <h3 class="font-semibold mb-3 text-gray-700">Score Range</h3>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm text-gray-600 mb-2">Minimum Score</label>
                                        <input type="range" v-model="filters.min_score" min="0" max="120" 
                                               class="w-full">
                                        <div class="text-center text-sm font-semibold mt-1">{{ filters.min_score }}</div>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-600 mb-2">Maximum Score</label>
                                        <input type="range" v-model="filters.max_score" min="0" max="120" 
                                               class="w-full">
                                        <div class="text-center text-sm font-semibold mt-1">{{ filters.max_score }}</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Strength Levels -->
                            <div class="border-b pb-4">
                                <h3 class="font-semibold mb-3 text-gray-700">Strength Levels</h3>
                                <div class="flex flex-wrap gap-2">
                                    <label v-for="level in strengthLevels" :key="level.name" 
                                           class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border-2 cursor-pointer transition-all"
                                           :class="filters.strength_levels.includes(level.name) ? 'border-blue-500 bg-blue-50' : 'border-gray-200'">
                                        <input type="checkbox" :value="level.name" v-model="filters.strength_levels" class="hidden">
                                        <span class="w-3 h-3 rounded-full" :style="{backgroundColor: level.color}"></span>
                                        <span>{{ level.name }}</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Technical Indicators -->
                            <div class="border-b pb-4">
                                <h3 class="font-semibold mb-3 text-gray-700">Technical Indicators</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm text-gray-600 mb-2">Minimum ADX</label>
                                        <input type="number" v-model.number="filters.min_adx" 
                                               class="w-full px-3 py-2 border rounded-lg" placeholder="20">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-600 mb-2">RSI Min</label>
                                        <input type="number" v-model.number="filters.rsi_min" 
                                               class="w-full px-3 py-2 border rounded-lg" placeholder="45">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-600 mb-2">RSI Max</label>
                                        <input type="number" v-model.number="filters.rsi_max" 
                                               class="w-full px-3 py-2 border rounded-lg" placeholder="80">
                                    </div>
                                </div>
                            </div>

                            <!-- Market Filters -->
                            <div>
                                <h3 class="font-semibold mb-3 text-gray-700">Market Filters</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm text-gray-600 mb-2">Sector</label>
                                        <select v-model="filters.sectors" multiple 
                                                class="w-full px-3 py-2 border rounded-lg">
                                            <option v-for="sector in availableSectors" :key="sector">{{ sector }}</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-600 mb-2">Min Price</label>
                                        <input type="number" v-model.number="filters.min_price" 
                                               class="w-full px-3 py-2 border rounded-lg" placeholder="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-600 mb-2">Max Price</label>
                                        <input type="number" v-model.number="filters.max_price" 
                                               class="w-full px-3 py-2 border rounded-lg" placeholder="10000">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </transition>

                    <!-- Action Buttons -->
                    <div class="flex gap-4 mt-6">
                        <button @click="screenStocks" :disabled="loading"
                                class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400 transition-colors">
                            {{ loading ? 'Screening...' : 'üîç Screen Stocks' }}
                        </button>
                        <button @click="resetFilters"
                                class="px-6 py-3 bg-gray-200 rounded-lg font-semibold hover:bg-gray-300 transition-colors">
                            Reset
                        </button>
                        <button v-if="results.length > 0" @click="exportToCSV"
                                class="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors">
                            üì• Export CSV
                        </button>
                    </div>
                </div>

                <!-- Loading State -->
                <div v-if="loading" class="bg-white rounded-lg shadow-md p-12 text-center">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <div class="text-gray-600">Analyzing stocks... This may take a moment.</div>
                </div>

                <!-- Results Summary -->
                <div v-if="!loading && screeningResult" class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center">
                        <div class="p-4 bg-blue-50 rounded-lg">
                            <div class="text-3xl font-bold text-blue-600">{{ screeningResult.total_screened }}</div>
                            <div class="text-sm text-gray-600 mt-1">Stocks Screened</div>
                        </div>
                        <div class="p-4 bg-green-50 rounded-lg">
                            <div class="text-3xl font-bold text-green-600">{{ screeningResult.total_matched }}</div>
                            <div class="text-sm text-gray-600 mt-1">Matches Found</div>
                        </div>
                        <div class="p-4 bg-purple-50 rounded-lg">
                            <div class="text-3xl font-bold text-purple-600">{{ screeningResult.execution_time }}s</div>
                            <div class="text-sm text-gray-600 mt-1">Execution Time</div>
                        </div>
                        <div class="p-4 bg-orange-50 rounded-lg">
                            <div class="text-3xl font-bold text-orange-600">{{ averageScore }}</div>
                            <div class="text-sm text-gray-600 mt-1">Average Score</div>
                        </div>
                    </div>
                </div>

                <!-- Results Table -->
                <div v-if="!loading && results.length > 0" class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-100 border-b-2 border-gray-200">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-semibold">Rank</th>
                                    <th @click="sortBy('symbol')" class="px-4 py-3 text-left text-sm font-semibold cursor-pointer hover:bg-gray-200 select-none">
                                        Stock <span class="text-blue-600">{{ getSortIcon('symbol') }}</span>
                                    </th>
                                    <th @click="sortBy('total_score')" class="px-4 py-3 text-left text-sm font-semibold cursor-pointer hover:bg-gray-200 select-none">
                                        Strength <span class="text-blue-600">{{ getSortIcon('total_score') }}</span>
                                    </th>
                                    <th @click="sortBy('price')" class="px-4 py-3 text-right text-sm font-semibold cursor-pointer hover:bg-gray-200 select-none">
                                        Price <span class="text-blue-600">{{ getSortIcon('price') }}</span>
                                    </th>
                                    <th @click="sortBy('change')" class="px-4 py-3 text-right text-sm font-semibold cursor-pointer hover:bg-gray-200 select-none">
                                        Change <span class="text-blue-600">{{ getSortIcon('change') }}</span>
                                    </th>
                                    <th @click="sortBy('rsi')" class="px-4 py-3 text-center text-sm font-semibold cursor-pointer hover:bg-gray-200 select-none">
                                        RSI <span class="text-blue-600">{{ getSortIcon('rsi') }}</span>
                                    </th>
                                    <th @click="sortBy('adx')" class="px-4 py-3 text-center text-sm font-semibold cursor-pointer hover:bg-gray-200 select-none">
                                        ADX <span class="text-blue-600">{{ getSortIcon('adx') }}</span>
                                    </th>
                                    <th @click="sortBy('volume_ratio')" class="px-4 py-3 text-center text-sm font-semibold cursor-pointer hover:bg-gray-200 select-none">
                                        Vol Ratio <span class="text-blue-600">{{ getSortIcon('volume_ratio') }}</span>
                                    </th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template v-for="(stock, index) in sortedResults" :key="stock.symbol">
                                    <tr class="border-b hover:bg-gray-50 cursor-pointer transition-colors"
                                        @click="toggleExpand(stock.symbol)">
                                        <td class="px-4 py-3">
                                            <div class="text-lg font-bold text-gray-600">#{{ index + 1 }}</div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="font-semibold text-gray-800">{{ stock.name }}</div>
                                            <div class="text-sm text-gray-500">{{ stock.symbol }} ‚Ä¢ {{ stock.sector }}</div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-white font-semibold text-sm"
                                                 :style="{backgroundColor: stock.color}"
                                                 :class="{'exceptional-glow': stock.classification === 'Exceptional'}">
                                                <span>{{ stock.total_score }}</span>
                                                <span class="text-xs opacity-90">{{ stock.classification }}</span>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3 text-right">
                                            <div class="font-semibold">‚Çπ{{ stock.price.toFixed(2) }}</div>
                                        </td>
                                        <td class="px-4 py-3 text-right">
                                            <div :class="stock.change >= 0 ? 'text-green-600' : 'text-red-600'"
                                                 class="font-semibold">
                                                {{ stock.change >= 0 ? '+' : '' }}{{ stock.change_pct.toFixed(2) }}%
                                            </div>
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm font-medium">
                                                {{ stock.indicators.rsi ? stock.indicators.rsi.toFixed(1) : 'N/A' }}
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded text-sm font-medium">
                                                {{ stock.indicators.adx ? stock.indicators.adx.toFixed(1) : 'N/A' }}
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded text-sm font-medium">
                                                {{ stock.indicators.volume_ratio ? stock.indicators.volume_ratio.toFixed(0) + '%' : 'N/A' }}
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <button @click.stop="toggleExpand(stock.symbol)"
                                                    class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">
                                                {{ expandedStocks[stock.symbol] ? '‚ñº Hide' : '‚ñ∂ Details' }}
                                            </button>
                                        </td>
                                    </tr>
                                    
                                    <!-- Expanded Details Row -->
                                    <tr v-if="expandedStocks[stock.symbol]" class="bg-blue-50 border-b">
                                        <td colspan="9" class="px-4 py-6">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <!-- Category Scores -->
                                                <div>
                                                    <h4 class="font-bold text-gray-700 mb-3">üìä Category Breakdown</h4>
                                                    <div class="space-y-2">
                                                        <div v-for="(score, category) in stock.category_scores" :key="category"
                                                             class="bg-white rounded-lg p-3">
                                                            <div class="flex justify-between items-center mb-1">
                                                                <span class="text-sm font-medium text-gray-700">{{ category }}</span>
                                                                <span class="text-sm font-bold text-blue-600">{{ score }} pts</span>
                                                            </div>
                                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                                <div class="bg-blue-600 h-2 rounded-full transition-all"
                                                                     :style="{width: getScorePercentage(category, score) + '%'}"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Technical Indicators -->
                                                <div>
                                                    <h4 class="font-bold text-gray-700 mb-3">üìà Technical Indicators</h4>
                                                    <div class="bg-white rounded-lg p-4 space-y-3">
                                                        <div class="flex justify-between">
                                                            <span class="text-gray-600">RSI (14):</span>
                                                            <span class="font-semibold">{{ stock.indicators.rsi || 'N/A' }}</span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span class="text-gray-600">ADX (14):</span>
                                                            <span class="font-semibold">{{ stock.indicators.adx || 'N/A' }}</span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span class="text-gray-600">MACD:</span>
                                                            <span class="font-semibold">{{ stock.indicators.macd || 'N/A' }}</span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span class="text-gray-600">Volume Ratio:</span>
                                                            <span class="font-semibold">{{ stock.indicators.volume_ratio ? stock.indicators.volume_ratio.toFixed(0) + '%' : 'N/A' }}</span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span class="text-gray-600">Distance from 50 SMA:</span>
                                                            <span :class="stock.indicators.distance_50sma >= 0 ? 'text-green-600' : 'text-red-600'"
                                                                  class="font-semibold">
                                                                {{ stock.indicators.distance_50sma ? stock.indicators.distance_50sma.toFixed(2) + '%' : 'N/A' }}
                                                            </span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span class="text-gray-600">Distance from 200 SMA:</span>
                                                            <span :class="stock.indicators.distance_200sma >= 0 ? 'text-green-600' : 'text-red-600'"
                                                                  class="font-semibold">
                                                                {{ stock.indicators.distance_200sma ? stock.indicators.distance_200sma.toFixed(2) + '%' : 'N/A' }}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- No Results -->
                <div v-if="!loading && results.length === 0 && screeningResult" 
                     class="bg-white rounded-lg shadow-md p-12 text-center">
                    <div class="text-6xl mb-4">üîç</div>
                    <div class="text-xl font-semibold text-gray-700 mb-2">No stocks matched your criteria</div>
                    <div class="text-gray-600">Try adjusting your filters or using a preset strategy</div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="bg-gray-800 text-white py-6 mt-12">
                <div class="container mx-auto px-4 text-center">
                    <p>Enhanced NSE Stock Screener v2.0 | 120-Point Scoring System</p>
                    <p class="text-sm text-gray-400 mt-2">Built with Vue.js 3 & FastAPI | Data from yfinance</p>
                </div>
            </footer>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    apiUrl: 'http://localhost:8000',
                    apiStatus: 'disconnected',
                    loading: false,
                    showFilters: true,
                    filters: {
                        min_score: 40,
                        max_score: 120,
                        strength_levels: [],
                        min_adx: null,
                        rsi_min: null,
                        rsi_max: null,
                        sectors: [],
                        min_price: null,
                        max_price: null
                    },
                    strengthLevels: [
                        { name: 'Exceptional', color: '#047857' },
                        { name: 'Very High', color: '#065f46' },
                        { name: 'High', color: '#059669' },
                        { name: 'Medium', color: '#d97706' },
                        { name: 'Low', color: '#dc2626' },
                        { name: 'Weak', color: '#991b1b' }
                    ],
                    availableSectors: [],
                    presets: {},
                    results: [],
                    screeningResult: null,
                    expandedStocks: {},
                    sortColumn: 'total_score',
                    sortDirection: 'desc'
                };
            },
            computed: {
                averageScore() {
                    if (this.results.length === 0) return 0;
                    const sum = this.results.reduce((acc, stock) => acc + stock.total_score, 0);
                    return (sum / this.results.length).toFixed(1);
                },
                sortedResults() {
                    if (this.results.length === 0) return [];
                    
                    const sorted = [...this.results].sort((a, b) => {
                        let aVal, bVal;
                        
                        switch(this.sortColumn) {
                            case 'symbol':
                                aVal = a.symbol;
                                bVal = b.symbol;
                                break;
                            case 'total_score':
                                aVal = a.total_score;
                                bVal = b.total_score;
                                break;
                            case 'price':
                                aVal = a.price;
                                bVal = b.price;
                                break;
                            case 'change':
                                aVal = a.change_pct;
                                bVal = b.change_pct;
                                break;
                            case 'rsi':
                                aVal = a.indicators.rsi || 0;
                                bVal = b.indicators.rsi || 0;
                                break;
                            case 'adx':
                                aVal = a.indicators.adx || 0;
                                bVal = b.indicators.adx || 0;
                                break;
                            case 'volume_ratio':
                                aVal = a.indicators.volume_ratio || 0;
                                bVal = b.indicators.volume_ratio || 0;
                                break;
                            default:
                                return 0;
                        }
                        
                        if (this.sortDirection === 'asc') {
                            return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                        } else {
                            return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                        }
                    });
                    
                    return sorted;
                }
            },
            methods: {
                async checkApiStatus() {
                    try {
                        const response = await axios.get(`${this.apiUrl}/api/v2/health`);
                        this.apiStatus = 'connected';
                    } catch (error) {
                        this.apiStatus = 'disconnected';
                        console.error('API connection failed:', error);
                    }
                },
                async loadPresets() {
                    try {
                        const response = await axios.get(`${this.apiUrl}/api/v2/presets`);
                        this.presets = response.data.presets;
                    } catch (error) {
                        console.error('Error loading presets:', error);
                    }
                },
                async loadSectors() {
                    try {
                        const response = await axios.get(`${this.apiUrl}/api/v2/sectors`);
                        this.availableSectors = response.data.sectors;
                    } catch (error) {
                        console.error('Error loading sectors:', error);
                    }
                },
                applyPreset(preset) {
                    const presetFilters = preset.filters;
                    this.filters.min_score = presetFilters.min_score || 40;
                    this.filters.min_adx = presetFilters.min_adx || null;
                    this.filters.rsi_min = presetFilters.rsi_min || null;
                    this.filters.rsi_max = presetFilters.rsi_max || null;
                    this.showFilters = true;
                },
                async screenStocks() {
                    this.loading = true;
                    this.results = [];
                    this.screeningResult = null;
                    
                    try {
                        const response = await axios.post(
                            `${this.apiUrl}/api/v2/stocks/screen`,
                            {
                                ...this.filters,
                                strength_levels: this.filters.strength_levels.length > 0 ? this.filters.strength_levels : null
                            }
                        );
                        
                        this.screeningResult = response.data;
                        this.results = response.data.results;
                        
                    } catch (error) {
                        console.error('Error screening stocks:', error);
                        alert('Error screening stocks. Please make sure the backend server is running.');
                    } finally {
                        this.loading = false;
                    }
                },
                resetFilters() {
                    this.filters = {
                        min_score: 40,
                        max_score: 120,
                        strength_levels: [],
                        min_adx: null,
                        rsi_min: null,
                        rsi_max: null,
                        sectors: [],
                        min_price: null,
                        max_price: null
                    };
                    this.results = [];
                    this.screeningResult = null;
                },
                toggleExpand(symbol) {
                    this.expandedStocks[symbol] = !this.expandedStocks[symbol];
                },
                sortBy(column) {
                    if (this.sortColumn === column) {
                        // Toggle direction if same column
                        this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        // New column, default to descending for scores, ascending for names
                        this.sortColumn = column;
                        this.sortDirection = column === 'symbol' ? 'asc' : 'desc';
                    }
                },
                getSortIcon(column) {
                    if (this.sortColumn !== column) return '‚áÖ';
                    return this.sortDirection === 'asc' ? '‚Üë' : '‚Üì';
                },
                getScorePercentage(category, score) {
                    const maxScores = {
                        'Trend Alignment': 25,
                        'Momentum & Strength': 35,
                        'Volume & Liquidity': 20,
                        'Price Action & Breakouts': 25,
                        'Volatility & Risk': 10,
                        'Ichimoku Cloud': 5
                    };
                    const max = maxScores[category] || 100;
                    return (score / max) * 100;
                },
                exportToCSV() {
                    const headers = ['Rank', 'Symbol', 'Name', 'Sector', 'Score', 'Classification', 'Price', 'Change%', 'RSI', 'ADX', 'Volume Ratio'];
                    const rows = this.results.map((stock, index) => [
                        index + 1,
                        stock.symbol,
                        stock.name,
                        stock.sector,
                        stock.total_score,
                        stock.classification,
                        stock.price,
                        stock.change_pct,
                        stock.indicators.rsi || 'N/A',
                        stock.indicators.adx || 'N/A',
                        stock.indicators.volume_ratio || 'N/A'
                    ]);
                    
                    const csvContent = [headers, ...rows]
                        .map(row => row.join(','))
                        .join('\n');
                    
                    const blob = new Blob([csvContent], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `nse_screener_results_${new Date().toISOString().split('T')[0]}.csv`;
                    a.click();
                }
            },
            mounted() {
                this.checkApiStatus();
                this.loadPresets();
                this.loadSectors();
                
                // Check API status every 30 seconds
                setInterval(this.checkApiStatus, 30000);
            }
        }).mount('#app');
    </script>
</body>
</html>